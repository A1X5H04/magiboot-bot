import { FormattedString } from "@grammyjs/parse-mode";
import { JobStatus } from "../types/ci";
import { createProgressBar } from "./generators";
import { PostMetadata } from "../types/schema";

type StatusMessage = {
    status: JobStatus;
    message: string;
    progress: number | undefined;
}

export function createStatusMessage({ status, message, progress }: StatusMessage) {
    const statusMap = {
        "completed": "âœ… Completed.",
        "failed": "âŒ Failed.",
        "pending": "â³ Pending.",
        "processing": "âš™ï¸ Processing."
    }
    
    if (status === "completed" || status === "failed" || status === "pending") {        
        return FormattedString.b(statusMap[status]).plain(`\n${message}`);
    }

    return FormattedString.b(`${statusMap[status]} `)
    .plain(` ${createProgressBar(progress ?? 0)}\n`)
    .plain(`ğŸ’¬ ${message}`);
}

export function createBootanimationPost({ title, creator, details }: Omit<PostMetadata, "download_url" | "video">) {
    return FormattedString.b(`ğŸï¸ ${title}`).plain("\n\n")
    .b("Details:\n")
    .plain("â€¢ Resolution: ").code(`${details.resolution.module} (${details.resolution.video})`).plain("\n")
    .plain("â€¢ FPS: ").code(details.fps).plain("\n")
    .plain("â€¢ Duration: ").code(`${details.duration}s`).plain("\n")
    .plain("â€¢ Type: ").code(details.type)
    .plain("\n\n")
    .b("âš™ï¸ How to Use").plain("\n")
    .plain("Flash the module via your favorite root solution: Magisk / KernelSU")
    .plain("\n\n")
    .b("âœ¨ Credits").plain("\n")
    .plain("â€¢ Animation By: ").link(creator.name, `tg://user?id=${creator.user_id}`).plain("\n")
    .plain("â€¢ Generated By: @magibootbot")
    .plain("\n\n")
    .plain("ğŸ‘¥ Join: @magiboot").plain("\n")
    .plain("ğŸ“¢ Follow for more animations & updates").plain("\n")
    .plain("ğŸ› ï¸ Issues? ").link("Report Here", "https://t.me/magibootchat")
}